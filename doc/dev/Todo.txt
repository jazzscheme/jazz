;;;
;;;; Todo
;;;


GC  : Guillaume Cartier (gcartier@jazzscheme.org)
SLC : Stephane Le Cornec (coleste@videotron.ca)
JLR : Jeremie Lasalle Ratelle (pouexmachinax@gmail.com)


HIGH : Must be done before the public open-source release


;;;
;;;; General
;;;


HIGH
- Marcel
  + Put a binary build on the website for Marcel (GC)
  + 2007 -> 2008 everywhere (GC)
+ Send Marc a good screenshot of Jazz and some basic info like line-of-code, ... (GC)


;;;
;;;; Build
;;;


HIGH
- Fix gcc pathname quoting that doesn't work on non windows platforms (GC)
- Use dynamic code to find the install dir under mac and windows (GC)
  - ummm not easy because we do not want to depend on compiled code in the kernel
- Copy the resources so that a binary release of Jazz can be 100% standalone and not require the source files (GC)
- Remove the test patch in jazz.jazz-source (GC)
- Be able to compile and build without Gambit installed (GC)
- Could we use git on the repo through http? (GC)
- We have to think about and go through the code for what happens if we make for unix but no windowing (GC)
+ Font and other literals should not repend on the platform at readtime but only at runtime (GC)
  - With that cleanly separate platform build from windowing
    - Be able to build the game server using only jazz and maybe platform
- On mac the jazz.pathname-normalize will return "/Users/..." that Jazz will incorrectly convert to
  just {File "Users" ...}

MEDIUM
- Add a clean command to scrap install folder to the build system
- Use ##current-user-interrupt-handler to correctly handle ctrl-c in both the build system process and it's subprocesses


;;;
;;;; Platform
;;;


HIGH
- Remove all lparams and wparams in platform-independant packages. (JLR)
- Find memory leaks in FFI packages. (JLR)
- We should investigate every platform function beginning by "(When handle" for logic errors. (JLR)
- Remove stupid or vulgar comments, dead code, etc. General cleanup. (JLR)
- Correctly implement the FFI in the walker. It still uses the old macros style. It should be able
  to know which types are pointers, structures, etc. (JLR)
- exact->inexact and inexact->exact. (JLR)
- Implement a standard FFI construct to get the c constant value. (c-constant type name . c-name) (JLR)
- Use the new with-event-mutex on x11 and carbon (JLR)

MEDIUM
- Decide if we are going to keep the platform-... naming scheme or if we are going to
  rename all that to better names (JLR)
- Reduce the number of methods in platform packages and Window class. Remove old ones, merge others. 
  (Ex. get-root-owner, get-front-frame,  get-top-window)
  (get-bounds, get-rectangle, set-bounds, etc.) (JLR)
- Check platform packages for internal c-functions that could be written as c-code (JLR)
- Implement play-sound in X11 and Carbon. (JLR)


;;;
;;;; Cairo
;;;


HIGH
- Check if there is a dotted line mode in cairo and change the tree accordingly. (JLR)
- Implement highlight-color. (JLR)
- Classbrowser tree lines have some missing pixels (JLR)

MEDIUM
- Reimplement zoom and scaling in cairo. (JLR)
- Use cairo to do the alpha blending. (JLR)
- Check if it could be better to use native bitmaps instead of pixman surfaces in cairo. (JLR)
- Try to remove all cairo-save and cairo-restore. This is a major problem because we need to work
  on a lot of painting logic to properly restore the states. (Is it even a good idea?) (JLR)
- Fix the cairo memory leaks. Add a deallocator to our structures and call foreign-nullify in the with special form.
  - This will probably unify with and with-closed
  - One thing that is very nice with foreign release functions (and wills!?) is that we do not need to wrap the
    expansion of with inside an unwind-protect (not 100% sure about this as sometimes, having the object closed in
    the dynamic scope is an important part of a function's semantics...)
- Implement scrolling as Image Surfaces bliting on all platform.


;;;
;;;; Carbon
;;;


HIGH
- Investigate why the carbon port is so slow. (JLR)


;;;
;;;; Windows
;;;


MEDIUM
- Find how to fix the ascent hack in Windows. (Use freetype in windows?) (JLR)
- Native Windows save-as dialog is buggy and can save as x.gLevel. Can reproduce by saving as to x.scm


;;;
;;;; X11
;;;


HIGH
- Implement cursors (JLR)
- Implement show-noactivate and hide-noactivate (JLR)
- Remove polling and find elegant solution for clipboard (JLR)
- Find why the window is scrolled after an F12 (JLR)
- Problems when selecting docked like the console and the searches that will stop showing
- Fix super slow scrolling using scrollbar. Maybe this is a general rendering problem
- Double-click on a docked title will lose focus so that we cannot for instance double-click again
- Why doesn't the login dialog appear centered
- Login dialog doesn't seem to have correct focus as pressing enter will not work
- Error: Unable to find get-self-form in {Component-Class} when quitting jedi (probably save pref)
- Move a frame or dialog by the title bar is buggy
- About jedi doesn't display correctly and clicking the red macos button quits the whole jedi
- Implement figure picker and in the meantime put them as unimplemented
- Try and find nicer fonts
- Implement using native window toplevel bar for the toplevel instead of our own
- Implement open-event-queue in Gambit
  - This will fix all threading problems like autopopup, autoscroll, ...

MEDIUM
- Fix the workspace switching in X11 to eliminate the glitches. This is a complex problem that is
  related to windows moving and sizing in X11. We must understand how it is related to flushing,
  the event loop and painting. The temporary solution is a action-store used when in locked-update.
  This should also fix the white toplevel at load time. (JLR)
- Check if it would be possible to receive mouse events only when we have the focus (JLR)
- Implement the expose-store as an inval-store instead. Cache the invals and then only generate
  one expose event when we get back to the loop. (As gtk does) (JLR)


;;;
;;;; Jedi
;;;


HIGH
- Eval in user class (GC)
- Eval in text should load module if not already loaded (GC)
- Go through every walk method to verify that it does *not* forward-expr when not needed (GC)
- We need a fast boot, up to login dialog (GC)
- Complete Jedi as a Gambit IDE (GC)
- Improve all the definitions / references displays where the whole identifier is shown (GC)
- Cleanup of all the obsolete stuff in jazz explorer from the old jazz language (GC)
- Integrate my test1 and test2 for terminal access somehow (GC)
- The bindings format needs to be improved as it forces us to unbind left-arrow to bind ctrl-a! (GC)
- Verify that the save-as dialog pops a warning if overriding an existing file (GC)

MEDIUM
- Should annotate new files New, New1, New2, ...
- With many open windows the Window menu can be too big and close as soon as it opens. Either put then together in submenus
  or have a dialog when >= 10
- Put offscreen? = false and take a *really* good look at all that gets painted. For instance when resizing the
  workbench splitter between the wb and the stage, very strange things get painted
- Very interesting idea to pretty-print results in the repl...
- Adding sha-1 to catalogs instead of file modification time would be nice
- Need a clean solution to previously-focused-root management. One solution that looks clean would be to
  have the platform focus *always* to the overlapped and do the whole focus management ourselves with
  the Focus view. That way all the application activation events can be replaced in a platform independent
  maner by focus-gain/lose of the toplevel overlapped that can then set / reset the previously-focused-root
- When compiling lets says jazz.catalog, the merge of declarations generates an error because for instance the autoload
  of X that was already present is added again and autoloads are not eq?
- Adding a file-modification-time column to search-results would enable to easily find some recent change like "where did
  I add those annoying debug"!
- Maybe one day move up the text logic to view which is clearly a generic algo of box layouting very similar to css
- For embeding views in texts, we need a rendering algo like html that goes botton-up as well as top-down
- By spliting the first column of the bindings manager into context / action it would become possible to sort by action
  to find a specific action like goto-line


;;;
;;;; Walker
;;;


MEDIUM
- Implement access rights to declarations
- At some point i should start looking at the generated c code for my typical code
- (in p (class X ... (definition some-x (new X)))) should generate a runtime error like Class X not fully loaded
- Because specifics don't have associated declarations, walk error in them get wrongly reported as beeing
  in their parent. Using the generic declaration is not correct as it will create illegal access problems.
  I will probably have to create dummy specific declarations or maybe this is yet again a macro problem
  that has to be solved with the complete macro solution...
- Looking at how to implement the enumeration macro cleanly make me think that a declare special form is to moving alot
  of code from the walker to high level macros
  - define
  - declare
  - annotate (!?)
  - relocate (!?)

  - (definition D expr)
  - (declare D <Definition-Declaration>
      (define D
        expr))
  
  - maybe definitions could even know their declaration which would unify the duplication between the 2
- The optimisation of having a language construct that splices a slot's content at the end of the
  object's vector could be correct i think if limited to final classes...
- Implement partial library access like importing jazz.platform.windows and then using (WinUser.RegisterClass ...)


;;;
;;;; Language
;;;


HIGH
- Implement type inference for the <X+> type (SLC)
- It would seem that with Y extends X and foo a non virtual method in Y. If Y is compiled and we add in X
  foo as a virtual method, then we get an error when loading Y. Work with stephane to have clearer messages for the rebase ones
  like "Cannot override existing virtual method". We absolutly need to support separate compilation... (SLC)

MEDIUM
- Use Marc's catcher to implement exceptions (SLC)
- When axises are working, simplify the code and make sure it is well optimized for the case of rows with not alot
  of sons
- I should be able to clean *alot* of not directly related code that i was forced to put inside classes because i
  didn't have generics. A class that needs big time cleanup like this is Component
- Why reimplement queues in Jazz? Probably just add access to them for Jazz
- Not allocate void slots
- Find a good and elegant solution to the register-autoclass patch
- Think about a naming convention (maybe CL's *symbol*) that would distinguish between global variables
  and class names that make code like (f~ X) hard to understand
- Look at ways to add currying to Jazz.


;;;
;;;; R4RS
;;;


MEDIUM
- r4rstest.scm
- f1.0 notation
- internal defines
- quasiquote for vectors
- =>
- semantics of declarations that are bound only after beeing defined vs jazz which binds declarations
  accross the whole module. another incompatibility that is related is that scheme code can define the
  same variable multiple times -> a possible solution would be to implement scheme semantics for define
  and jazz semantics for definition which seems very consistant with both names


;;;
;;;; Types
;;;


MEDIUM
- With a restriction type we could have a type like fxstring that is a string that guaranties that
  its length is bounded in the range of fixnums!?
- Put back Rect as fx and make another class for number (or the opposite)
- Because I want to do all type casting at call site for natives, I will need to always call the lowlevel
  ## version of the procedure
- Ummm I think that saying car's signature is <pair:object> is wrong. Really, car's signature is <object:object>
  and throws an error if its parameter is not a pair. The <pair:object> is really a compile time specializer!
- Specialize iterate and accumulate on basic classes
- Decide if it is correct to only annotate the root method (annotations in a derived method should report an error)
  or maybe validate that the derived annotations are the same!?


;;;
;;;; Optimize
;;;


MEDIUM
- why are WinUser, ... appearing as .jazz in statprof??
- optimize the interpreted caching would seem to be very critical
  - ahhh not really... why does it get always called is the right question!
  - look with marc at how can jazz.cache-dispatch-interpreted appear in the statprof report
    when it is even called! is it because of how we set! the dispatcher that gambit gets mixed up?


;;;
;;;; Debugger
;;;


MEDIUM
- Debugging-Environment as the top object!?
- Debuggers must integrate with
  - console
  - stack
  - variables
  - break points
  - tooltip debugging
  - memory inspector


;;;
;;;; Emacs
;;;


MEDIUM
- ctrl-K kill to end (augment progressively)
- ctrl-S-R search incremental
- ctrl-W kill region cut from mark to cursor
- ctrl-Y paste (yank)
- ctrl-Z suspend and iconify


;;;
;;;; Interpreter
;;;


MEDIUM
- Determine the exact redefinition rules
  - Jazz -> Blues -> C++ -> Compiled Code
  - Jazz -> Blues -> Interpreted Code
- Policies
  - Debug
  - Release
  - Distribution
- Actions
  - add slot
  - redefine slot
  - remove slot
  - add method
  - redefine method
  - remove method
  - modify visibility
  - modify virtual
  - change slot -> definition
  - change definition -> slot


;;;
;;;; RMI
;;;


MEDIUM
- An interesting concept is to extend the RMI concept to inter-thread communication which would result in
  calling a thread connector through a proxy. What is nice is that the thread could be included in the IOR
  and the call be made directly even from another process. On the other hand it is very heavy to have to
  always marshall when calling in process between threads... We will see when the remote debugger implements
  the concept directly to support multi-thread debugging...
- Une idee fort interessante est l'implementation du dispatch rmi et autres par:
  [X.foo x y z] qui est equivalent a
  (Dispatchable.dispatch x 'X.foo y z)
  (class IOR
    (method (dispatch ...)
      (rmi-call ...)))
  Ca correspont a une implementation tres simple du dispatch rmi via un dynamic invoke (comme dans
  la nouvelle version de Java)


;;;
;;;; Doc
;;;


HIGH
- It is very important to document for each toplevel module at least it's level of completion. Something like
  - commercial quality
  - not yet '' but very usable
  - experimental
  - ...


;;;
;;;; Website
;;;


HIGH
- Basic tutorials (GC)
- Someone looking at the website for the first time concluded that Jazz was 95x slower than the C++ version! Need to make it clearer (GC)


;;;
;;;; Marc
;;;


HIGH
- Fix the first error never having a stack
- Can start jedi either
  - from a gsc console already running a repl
  - as a standalone executable
- Ask marc exactly what he did to register gambit to freenode
- On mac, resizing the console while building will error!!!
  - Interrupted system call (open-process ...)


;;;
;;;; Snow
;;;


MEDIUM
- Can we work around the fact that the snow package* form doesn't enclose the whole file content?
- Need a solution to snow's name including the version and having periods in it
- The snow packages need to be jazz modules to include any kind of scheme code but they also need to
  be jazz libraries for optional / named parameters and name scoping...


;;;
;;;; Statprof
;;;


MEDIUM
- should not index the buckets on file/line/col but rather on the continuation-code object itself
  so that 2 expressions on the same line are treated separately
- should keep the stack of callers so that in the report I can show that the 16% is divided between
  those 3 call branches
- the key is what gambit object represent static code and are stable?


;;;
;;;; Termite
;;;


MEDIUM
- Not clear in documentation that there is a primordial process that is not the direct result of a spawn
- node-init is not in the doc
- Does termite implement message passing in a way that no tcp/ip is used for intra-node calls?
- Look at Guillaume Germain's Dynamite web server!?
- So is make-node to be used both for the actual node and for remotes and only the actual should call node-init ?
- Everything i try crashes. There is no error validation? (node-init (current-node)) for instance
- What does guillaume think about an RMI layer on top of termite
