;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; Jazz ODBC low-level
;;;


(module jazz.platform.odbc.odbc-lowlevel jazz

(import (jazz.platform.types)
        (jazz.platform.windows.WinTypes)
        (jazz.foreign (phase syntax))
        (jazz.platform.types-syntax (phase syntax)))

(c-include "<sql.h>")
(c-include "<sqlext.h>")


(c-type SWORD short)
(c-type UWORD ushort)
(c-type SDWORD long)
(c-type SQLSMALLINT SWORD)
(c-type SQLUSMALLINT UWORD)
(c-type SQLSMALLINT* (pointer SQLSMALLINT))
(define-pointer-to-type SQLSMALLINT "SQLSMALLINT")
(c-type SQLINTEGER SDWORD)
(c-type SQLLEN SQLINTEGER)
(c-type SQLLEN* (pointer SQLLEN))
(define-pointer-to-type SQLLEN "SQLLEN")

(c-type SQLPOINTER void*)

(c-type SQLHANDLE void*)
(c-type SQLHANDLE* (pointer SQLHANDLE))
(define-pointer-to-type SQLHANDLE "SQLHANDLE")
(c-type SQLHENV SQLHANDLE)
(c-type SQLHDBC SQLHANDLE)
(c-type SQLHSTMT SQLHANDLE)
(c-type SQLHDESC SQLHANDLE)
(c-type SQLHENV* SQLHANDLE*)
(c-type SQLHDBC* SQLHANDLE*)
(c-type SQLHSTMT* SQLHANDLE*)
(c-type SQLHDESC* SQLHANDLE*)
(define-cast-lambda-ptr SQLHANDLE SQLHENV)
(define-cast-lambda-ptr SQLHANDLE SQLHDBC)
(define-cast-lambda-ptr SQLHANDLE SQLHSTMT)
(define-cast-lambda-ptr SQLHANDLE SQLHDESC)

(c-type SQLHWND HWND)
(c-type SQLRETURN SQLSMALLINT)

(c-type SQLCHAR unsigned-char)
(c-type SQLWCHAR wchar_t)
(c-type SQLCHAR* (pointer SQLCHAR))
(c-type SQLWCHAR* (pointer SQLWCHAR))
(define-pointer-to-type SQLCHAR "SQLCHAR")
(define-cast-lambda SQLCHAR* char-string)
(define-cast-lambda-ptr uint8* SQLCHAR*)
  

(definition public wchar_t*->wchar_t-string-ref
  (c-function (wchar_t* int) wchar_t-string
    "___result = ___arg1 + ___arg2;"
     ))


(definition public char*->char-string-ref
  (c-function (char* int) char-string
    "___result = ___arg1 + ___arg2;"
     ))


(definition public (char-string->SQLCHAR* string)
  (uint8*->SQLCHAR* (char-string->uint8* string)))


(definition public SQLGetDiagField$
  (c-function (SQLSMALLINT SQLHANDLE SQLSMALLINT SQLSMALLINT SQLPOINTER SQLSMALLINT SQLSMALLINT*) SQLRETURN "SQLGetDiagField"))


(definition public SQLAllocHandleStd$
  (c-function (SQLSMALLINT SQLHANDLE SQLHANDLE*) SQLRETURN "SQLAllocHandleStd"))


(definition public SQLDriverConnect$
  (c-function (SQLHDBC SQLHWND char-string SQLSMALLINT SQLCHAR* SQLSMALLINT SQLSMALLINT* SQLUSMALLINT) SQLRETURN "SQLDriverConnect"))


(definition public SQLExecDirect$
  (c-function (SQLHSTMT SQLCHAR* SQLINTEGER) SQLRETURN "SQLExecDirect"))


(definition public SQLNumResultCols$
  (c-function (SQLHSTMT SQLSMALLINT*) SQLRETURN "SQLNumResultCols"))


(definition public SQLFreeHandle$
  (c-function (SQLSMALLINT SQLHANDLE) SQLRETURN "SQLFreeHandle"))


(definition public SQLDisconnect$
  (c-function (SQLHDBC) SQLRETURN "SQLDisconnect"))


(definition public SQLColAttribute$
  (c-function (SQLHSTMT SQLUSMALLINT SQLUSMALLINT SQLPOINTER SQLSMALLINT SQLSMALLINT* SQLLEN*) SQLRETURN "SQLColAttribute"))


(definition public SQLBindCol$
  (c-function (SQLHSTMT SQLUSMALLINT SQLSMALLINT SQLPOINTER SQLLEN SQLLEN*) SQLRETURN "SQLBindCol"))


(definition public SQLFetch$
  (c-function (SQLHSTMT) SQLRETURN "SQLFetch"))
)
