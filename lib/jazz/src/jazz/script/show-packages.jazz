(script jazz

(import (jazz.runtime))

(definition (show-packages)
  (let ((repositories (get-repositories))
        (packages '()))
    (for-each (lambda (repository)
                (unless (repository-binary? repository)
                  (iterate-packages repository
                    (lambda (package)
                      (set! packages (cons package packages))))))
              repositories)
    (for-each (lambda (package)
                (let ((name (package-name package))
                      (description (package-description package))
                      (authors (package-authors package)))
                  (when description
                    (format :console "{a}{?, {a}~}{?, {l detail: :human separator: \", \"}~}{%}" name description authors))))
              (sort ci<? packages key: package-name))))

(show-packages))
