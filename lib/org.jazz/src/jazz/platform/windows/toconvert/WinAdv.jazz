;;;==============
;;;  JazzScheme
;;;==============
;;;
;;;; Windows Advanced API Definitions
;;;
;;;  The contents of this file are subject to the Mozilla Public License Version
;;;  1.1 (the "License"); you may not use this file except in compliance with
;;;  the License. You may obtain a copy of the License at
;;;  http://www.mozilla.org/MPL/
;;;
;;;  Software distributed under the License is distributed on an "AS IS" basis,
;;;  WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
;;;  for the specific language governing rights and limitations under the
;;;  License.
;;;
;;;  The Original Code is JazzScheme.
;;;
;;;  The Initial Developer of the Original Code is Guillaume Cartier.
;;;  Portions created by the Initial Developer are Copyright (C) 1996-2008
;;;  the Initial Developer. All Rights Reserved.
;;;
;;;  Contributor(s):
;;;
;;;  Alternatively, the contents of this file may be used under the terms of
;;;  the GNU General Public License Version 2 or later (the "GPL"), in which
;;;  case the provisions of the GPL are applicable instead of those above. If
;;;  you wish to allow use of your version of this file only under the terms of
;;;  the GPL, and not to allow others to use your version of this file under the
;;;  terms of the MPL, indicate your decision by deleting the provisions above
;;;  and replace them with the notice and other provisions required by the GPL.
;;;  If you do not delete the provisions above, a recipient may use your version
;;;  of this file under the terms of any one of the MPL or the GPL.
;;;
;;;  See www.jazzscheme.org for details.


(library WinAdv jazz


@WAIT (


  ;;;
  ;;;; Constants
  ;;;

  
  (c-constant HKEY_CLASSES_ROOT                      #x80000000)
  (c-constant HKEY_CURRENT_USER                      #x80000001)
  (c-constant HKEY_LOCAL_MACHINE                     #x80000002)
  (c-constant HKEY_USERS                             #x80000003)
  (c-constant HKEY_PERFORMANCE_DATA                  #x80000004)
  (c-constant HKEY_CURRENT_CONFIG                    #x80000005)
  (c-constant HKEY_DYN_DATA                          #x80000006)
  (c-constant SERVICE_CONTROL_STOP                   #x00000001)
  (c-constant SERVICE_CONTROL_PAUSE                  #x00000002)
  (c-constant SERVICE_CONTROL_CONTINUE               #x00000003)
  (c-constant SERVICE_CONTROL_INTERROGATE            #x00000004)
  (c-constant SERVICE_CONTROL_SHUTDOWN               #x00000005)
  (c-constant SERVICE_CONTROL_PARAMCHANGE            #x00000006)
  (c-constant SERVICE_STOPPED                        #x00000001)
  (c-constant SERVICE_START_PENDING                  #x00000002)
  (c-constant SERVICE_STOP_PENDING                   #x00000003)
  (c-constant SERVICE_RUNNING                        #x00000004)
  (c-constant SERVICE_CONTINUE_PENDING               #x00000005)
  (c-constant SERVICE_PAUSE_PENDING                  #x00000006)
  (c-constant SERVICE_PAUSED                         #x00000007)
  (c-constant SERVICE_ACCEPT_STOP                    #x00000001)
  (c-constant SERVICE_ACCEPT_PAUSE_CONTINUE          #x00000002)
  (c-constant SERVICE_ACCEPT_SHUTDOWN                #x00000004)
  (c-constant SERVICE_ACCEPT_PARAMCHANGE             #x00000008)
  (c-constant SERVICE_WIN32_OWN_PROCESS              #x00000010)
  (c-constant EVENTLOG_SUCCESS                       #x0000)
  (c-constant EVENTLOG_ERROR_TYPE                    #x0001)
  (c-constant EVENTLOG_WARNING_TYPE                  #x0002)
  (c-constant EVENTLOG_INFORMATION_TYPE              #x0004)
  (c-constant EVENTLOG_AUDIT_SUCCESS                 #x0008)
  (c-constant EVENTLOG_AUDIT_FAILURE                 #x0010)
  
  
  (c-constant SC_MANAGER_CONNECT                     #x0001)
  (c-constant SC_MANAGER_CREATE_SERVICE              #x0002)
  (c-constant SC_MANAGER_ENUMERATE_SERVICE           #x0004)
  (c-constant SC_MANAGER_LOCK                        #x0008)
  (c-constant SC_MANAGER_QUERY_LOCK_STATUS           #x0010)
  (c-constant SC_MANAGER_MODIFY_BOOT_CONFIG          #x0020)

  (c-constant SC_MANAGER_ALL_ACCESS
    (bitwise-ior STANDARD_RIGHTS_REQUIRED
                 SC_MANAGER_CONNECT
                 SC_MANAGER_CREATE_SERVICE
                 SC_MANAGER_ENUMERATE_SERVICE
                 SC_MANAGER_LOCK
                 SC_MANAGER_QUERY_LOCK_STATUS
                 SC_MANAGER_MODIFY_BOOT_CONFIG))
  
  
  (c-constant SERVICE_QUERY_CONFIG                   #x0001)
  (c-constant SERVICE_CHANGE_CONFIG                  #x0002)
  (c-constant SERVICE_QUERY_STATUS                   #x0004)
  (c-constant SERVICE_ENUMERATE_DEPENDENTS           #x0008)
  (c-constant SERVICE_START                          #x0010)
  (c-constant SERVICE_STOP                           #x0020)
  (c-constant SERVICE_PAUSE_CONTINUE                 #x0040)
  (c-constant SERVICE_INTERROGATE                    #x0080)
  (c-constant SERVICE_USER_DEFINED_CONTROL           #x0100)

  (c-constant SERVICE_ALL_ACCESS
    (bitwise-ior STANDARD_RIGHTS_REQUIRED
                 SERVICE_QUERY_CONFIG
                 SERVICE_CHANGE_CONFIG
                 SERVICE_QUERY_STATUS
                 SERVICE_ENUMERATE_DEPENDENTS
                 SERVICE_START
                 SERVICE_STOP
                 SERVICE_PAUSE_CONTINUE
                 SERVICE_INTERROGATE
                 SERVICE_USER_DEFINED_CONTROL))

  
  ;;;
  ;;;; Structures
  ;;;
  
  
  (structure SERVICE_STATUS
    (int   dwServiceType)
    (int   dwCurrentState)
    (int   dwControlsAccepted)
    (int   dwWin32ExitCode)
    (int   dwServiceSpecificExitCode)
    (int   dwCheckPoint)
    (int   dwWaitHint))


  ;;;
  ;;;; Externals
  ;;;
  
  
  ;; Relation between ReportEvent and *.mc files
  ;; Event Viewer receives the exact event-id passed to ReportEvent. This value
  ;; is not modified by the EVENTLOG_*_TYPE passed along. Message files must
  ;; use the same Severity + Facility + MessageId. If the event-id is not found
  ;; in the message dll, it will display the default unknown message.
  ;; event-id = #x40000001 -> Severity=Informational + Facility=System + MessageId=#x1


  (winexternal AdvAPI bool            (GetUserName                             string <in-out> int&)                                                                              "GetUserNameW")
  (winexternal AdvAPI int             (RegOpenKeyEx                            int string int int <out> int&)                                                                     "RegOpenKeyExW")
  (winexternal AdvAPI int             (RegCreateKey                            int string <out> int&)                                                                             "RegCreateKeyW")
  (winexternal AdvAPI int             (RegQueryValue                           int string string <in-out> int&)                                                                   "RegQueryValueW")
  (winexternal AdvAPI int             (RegQueryValueEx                         int string int <out> int& string <in-out> int&)                                                    "RegQueryValueExW")
  (winexternal AdvAPI int             (RegSetValue                             int string int string int)                                                                         "RegSetValueW")
  (winexternal AdvAPI int             (RegSetValueEx                           int string int int string int)                                                                     "RegSetValueExW")
  (winexternal AdvAPI int             (RegCloseKey                             int))
  (winexternal AdvAPI int             (RegEnumKey                              int int string int)                                                                                "RegEnumKeyW")
  (winexternal AdvAPI int             (RegEnumKeyEx                            int int string <in-out> int& <in-out> int& string <in-out> int& FILETIME&)                         "RegEnumKeyExW")
  (winexternal AdvAPI int             (OpenSCManager                           string string int)                                                                                 "OpenSCManagerW")
  (winexternal AdvAPI int             (CreateService                           int string string int int int int string string param string string string)                        "CreateServiceW")
  (winexternal AdvAPI int             (OpenService                             int string int)                                                                                    "OpenServiceW")
  (winexternal AdvAPI bool            (DeleteService                           int))
  (winexternal AdvAPI bool            (CloseServiceHandle                      int))
  (winexternal AdvAPI bool            (SetServiceStatus                        int SERVICE_STATUS&))
  (winexternal AdvAPI int             (RegisterEventSource                     string string)                                                                                     "RegisterEventSourceW")
  (winexternal AdvAPI bool            (ReportEvent                             int short short int param short int param param)                                                   "ReportEventW"))
)