(library jazz.platform.x11 jazz

(c-include "<X11/Xlib.h>")  
(c-include "<X11/Xutil.h>")
(c-include "<stdlib.h>")
(c-include "<string.h>")

(constant None                     #x00000000)
(constant CopyFromParent           #x00000000)
(constant InputOutput              1)

;; Event Masks

(constant NoEventMask			     #x00000000)
(constant KeyPressMask		     #x00000001) 
(constant KeyReleaseMask		     #x00000002) 
(constant ButtonPressMask		     #x00000004) 
(constant ButtonReleaseMask		 #x00000008)
(constant EnterWindowMask		     #x00000010) 
(constant LeaveWindowMask		     #x00000020) 
(constant PointerMotionMask		 #x00000040)
(constant PointerMotionHintMask	 #x00000080) 
(constant Button1MotionMask		 #x00000100) 
(constant Button2MotionMask		 #x00000200) 
(constant Button3MotionMask		 #x00000400)
(constant Button4MotionMask		 #x00000800)
(constant Button5MotionMask		 #x00001000)
(constant ButtonMotionMask		 #x00002000)
(constant KeymapStateMask		     #x00004000)
(constant ExposureMask		     #x00008000)
(constant VisibilityChangeMask	 #x00010000)
(constant StructureNotifyMask		 #x00020000)
(constant ResizeRedirectMask		 #x00040000)
(constant SubstructureNotifyMask	 #x00080000)
(constant SubstructureRedirectMask #x00100000)
(constant FocusChangeMask		     #x00200000)
(constant PropertyChangeMask		 #x00400000)
(constant ColormapChangeMask		 #x00800000)
(constant OwnerGrabButtonMask		 #x01000000)

;; Event Types

(constant KeyPress		 2)
(constant KeyRelease		 3)
(constant ButtonPress		 4)
(constant ButtonRelease	 5)
(constant MotionNotify	 6)
(constant EnterNotify		 7)
(constant LeaveNotify		 8)
(constant FocusIn		     9)
(constant FocusOut		 10)
(constant KeymapNotify	 11)
(constant Expose		     12)
(constant GraphicsExpose	 13)
(constant NoExpose		 14)
(constant VisibilityNotify 15)
(constant CreateNotify	 16)
(constant DestroyNotify	 17)
(constant UnmapNotify		 18)
(constant MapNotify		 19)
(constant MapRequest		 20)
(constant ReparentNotify	 21)
(constant ConfigureNotify	 22)
(constant ConfigureRequest 23)
(constant GravityNotify	 24)
(constant ResizeRequest	 25)
(constant CirculateNotify  26)
(constant CirculateRequest 27)
(constant PropertyNotify   28)
(constant SelectionClear   29)
(constant SelectionRequest 30)
(constant SelectionNotify	 31)
(constant ColormapNotify   32)
(constant ClientMessage    33)
(constant MappingNotify    34)
(constant LASTEvent        35)

;; Window attribute value mask bits

(constant CWBackPixmap        #x00000001)
(constant CWBackPixel         #x00000002)
(constant CWBorderPixmap      #x00000004)
(constant CWBorderPixel       #x00000008)
(constant CWBitGravity        #x00000010)
(constant CWWinGravity        #x00000020)
(constant CWBackingStore      #x00000040)
(constant CWBackingPlanes     #x00000080)
(constant CWBackingPixel      #x00000100)
(constant CWOverrideRedirect  #x00000200)
(constant CWSaveUnder         #x00000400)
(constant CWEventMask         #x00000800)
(constant CWDontPropagate     #x00001000)
(constant CWColormap          #x00002000)  
(constant CWCursor            #x00004000)


(constant Button1 1)
(constant Button2 2)
(constant Button3 3)
(constant Button4 4)
(constant Button5 5)


(constant XK_Shift_L   #xffe1)
(constant XK_Shift_R   #xffe2)
(constant XK_Control_L #xffe3)
(constant XK_Control_R #xffe4)
(constant XK_Alt_R     #xffe9)
(constant XK_Alt_L     #xffea)

(c-type char       (native char))
(c-type char*      (pointer char))
(c-type int        (native int))
(c-type long       (native long))
(c-type long*      (pointer long))
(c-type uint       (native unsigned-int))
(c-type ulong      (native unsigned-long))
(c-type Bool       (native bool))
(c-type void       (native void))

(c-type Display    (native "Display"))
(c-type Display*   (pointer Display))
(c-type Screen     (native "Screen"))
(c-type Screen*    (pointer Screen))
(c-type Visual     (native "Visual"))
(c-type Visual*    (pointer Visual))
(c-type XID        (native unsigned-long))
(c-type Window     XID)
(c-type Drawable   XID)
(c-type Pixmap     XID)
(c-type Colormap   XID)
(c-type Cursor     XID)
(c-type KeySym     XID)
(c-type Time       (native unsigned-long))
(c-type Status     int)

(c-type KeyCode    (native unsigned-char))

(c-type Atom       XID)

(c-structure XSetWindowAttributes
  (Pixmap background_pixmap)
  (ulong background_pixel)
  (Pixmap border_pixmap)
  (ulong border_pixel)
  (int bit_gravity)
  (int win_gravity)
  (int backing_store)
  (ulong backing_planes)
  (ulong backing_pixel)
  (Bool save_under)
  (long event_mask)
  (long do_not_propagate_mask)
  (Bool override_redirect)
  (Colormap colormap)
  (Cursor cursor))

(c-structure XAnyEvent
  (int type)
  (ulong serial)	
  (Bool send_event)	
  (Display* display)
  (Window window))

(c-structure XButtonEvent 
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Window root)
  (Window subwindow)
  (Time time)
  (int x)
  (int y)
  (int x_root)
  (int y_root)
  (uint state)
  (uint button)
  (Bool same_screen))

(c-structure XKeyEvent 
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Window root)
  (Window subwindow)
  (Time time)
  (int x)
  (int y)
  (int x_root)
  (int y_root)
  (uint state)
  (uint keycode)
  (Bool same_screen))


(c-structure XMotionEvent 
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Window root)
  (Window subwindow)
  (Time time)
  (int x)
  (int y)
  (int x_root)
  (int y_root)
  (uint state)
  (char is_hint)
  (Bool same_screen))


(c-structure XCrossingEvent 
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Window root)
  (Window subwindow)
  (Time time)
  (int x)
  (int y)
  (int x_root)
  (int y_root)
  (int mode)
  (int detail)
  (Bool same_screen)
  (Bool focus)
  (uint state))


(c-structure XFocusChangeEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (int mode)
  (int detail))


(c-structure XKeymapEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (char key_vector 32))

(c-structure XExposeEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (int x)
  (int y)
  (int width)
  (int height)
  (int count))


(c-structure XGraphicsExposeEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Drawable drawable)
  (int x)
  (int y)
  (int width)
  (int height)
  (int count)
  (int major_code)
  (int minor_code))


(c-structure XNoExposeEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Drawable drawable)
  (int major_code)
  (int minor_code))


(c-structure XVisibilityEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (int state))

(c-structure XCreateWindowEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window parent)
  (Window window)
  (int x)
  (int y)
  (int width)
  (int height)
  (int border_width)
  (Bool override_redirect))

(c-structure XDestroyWindowEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window))


(c-structure XUnmapEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (Bool from_configure))

(c-structure XMapEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (Bool override_redirect))

(c-structure XMapRequestEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window parent)
  (Window window))

(c-structure XReparentEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (Window parent)
  (int x)
  (int y)
  (Bool override_redirect))

(c-structure XConfigureEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (int x)
  (int y)
  (int width)
  (int height)
  (int border_width)
  (Window above)
  (Bool override_redirect))

(c-structure XGravityEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (int x)
  (int y))


(c-structure XResizeRequestEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (int width)
  (int height))


(c-structure XConfigureRequestEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window parent)
  (Window window)
  (int x)
  (int y)
  (int width)
  (int height)
  (int border_width)
  (Window above)
  (int detail)
  (ulong value_mask))

(c-structure XCirculateEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window event)
  (Window window)
  (int place))


(c-structure XCirculateRequestEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window parent)
  (Window window)
  (int place))

(c-structure XPropertyEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Atom atom)
  (Time time)
  (int state))

(c-structure XSelectionClearEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Atom selection)
  (Time time))


(c-structure XSelectionRequestEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window owner)
  (Window requestor)
  (Atom selection)
  (Atom target)
  (Atom property)
  (Time time))

(c-structure XSelectionEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window requestor)
  (Atom selection)
  (Atom target)
  (Atom property)
  (Time time))

(c-structure XColormapEvent
  (int type)
  (ulong serial)
  (Bool send_event)
  (Display* display)
  (Window window)
  (Colormap colormap)
  (Bool new)
  (int state))

(c-type XClientMessageEvent  (native "XClientMessageEvent"))
(c-type XClientMessageEvent* (pointer XClientMessageEvent))
(c-type XMappingEvent        (native "XMappingEvent"))
(c-type XMappingEvent*       (pointer XMappingEvent))
(c-type XErrorEvent          (native "XErrorEvent"))
(c-type XErrorEvent*         (pointer XErrorEvent))


(c-union XEvent
         (int type)	
         (XAnyEvent xany embed)
         (XKeyEvent xkey embed)
         (XButtonEvent xbutton embed)
         (XMotionEvent xmotion embed)
         (XCrossingEvent xcrossing embed)
         (XFocusChangeEvent xfocus embed)
         (XExposeEvent xexpose embed)
         (XGraphicsExposeEvent xgraphicsexpose embed)
         (XNoExposeEvent xnoexpose embed)
         (XVisibilityEvent xvisibility embed)
         (XCreateWindowEvent xcreatewindow embed)
         (XDestroyWindowEvent xdestroywindow embed)
         (XUnmapEvent xunmap embed)
         (XMapEvent xmap embed)
         (XMapRequestEvent xmaprequest embed)
         (XReparentEvent xreparent embed)
         (XConfigureEvent xconfigure embed)
         (XGravityEvent xgravity embed)
         (XResizeRequestEvent xresizerequest embed)
         (XConfigureRequestEvent xconfigurerequest embed)
         (XCirculateEvent xcirculate embed)
         (XCirculateRequestEvent xcirculaterequest embed)
         (XPropertyEvent xproperty embed)
         (XSelectionClearEvent xselectionclear embed)
         (XSelectionRequestEvent xselectionrequest embed)
         (XSelectionEvent xselection embed)
         (XColormapEvent xcolormap embed)
         (XClientMessageEvent xclient embed)
         (XMappingEvent xmapping embed)
         (XErrorEvent xerror embed)
         (XKeymapEvent xkeymap embed)
         (long pad 24))


(c-structure  XWindowAttributes
  (int x)
  (int y)
  (int width)
  (int height)
  (int border_width)
  (int depth)
  (Visual* visual)
  (Window root)
  (int class)
  (int bit_gravity)
  (int win_gravity)
  (int backing_store)
  (ulong backing_planes)
  (ulong backing_pixel)
  (Bool save_under)
  (Colormap colormap)
  (Bool map_installed)
  (int map_state)
  (long all_event_masks)
  (long your_event_mask)
  (long do_not_propagate_mask)
  (Bool override_redirect)
  (Screen* screen))


(c-external void         (XClearArea             Display* Window int int uint uint Bool))
(c-external Display*     (XOpenDisplay           char*))
(c-external int          (XCloseDisplay          Display*))
(c-external int          (XDefaultScreen         Display*))
(c-external Screen*      (XScreenOfDisplay       Display* int))
(c-external Window       (XRootWindow            Display* int))
(c-external ulong        (XBlackPixel            Display* int))
(c-external ulong        (XWhitePixel            Display* int))
(c-external Window       (XCreateSimpleWindow    Display* Window int int uint uint uint ulong ulong))
(c-external int          (XMapWindow             Display* Window))
(c-external int          (XFlush                 Display*))
(c-external Visual*      (XDefaultVisual         Display* int))
(c-external void         (XNextEvent             Display* XEvent*))
(c-external void         (XSelectInput           Display* Window long))
(c-external void         (XDestroyWindow         Display* Window))
(c-external void         (XUnmapWindow           Display* Window))
(c-external Window       (XCreateWindow          Display* Window int int uint uint uint int uint Visual* ulong XSetWindowAttributes*))
(c-external Status       (XGetWindowAttributes   Display* Window XWindowAttributes*))
(c-external void         (XMoveWindow            Display* Window int int))
(c-external void         (XResizeWindow          Display* Window uint uint))
(c-external KeyCode      (XKeysymToKeycode       Display* KeySym))
(c-external void         (XReparentWindow        Display* Window Window int int))

(definition XKeyDown? 
  (c-function (Display* int) Bool
    "char keys[32];
     XQueryKeymap(___arg1, keys);
     ___result = keys[___arg2/8] & (1 << (___arg2%8));"))

(definition default-x11-display (XOpenDisplay #f)))
